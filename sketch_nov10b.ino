/*
  БЛЯТЬ ЭТО МОЯ ИГРА НА РЕАКЦИЮ КОТОРУЮ Я ПИЛИЛ 3 ДНЯ
  ТУТ ЕСТЬ ЭКРАН И 4 КНОПКИ - ВСЁ КАК У ВЗРОСЛЫХ
  ЕСЛИ ЧТО-ТО НЕ РАБОТАЕТ - ЭТО НЕ МОЯ ВИНА А АРДУИНО ДУРАК
  А ЕЩЕ ЕСЛИ ТЕКСТ НАЕЗЖАЕТ - ЭТО ПРОСТО ТАК ЗАДУМАНО, ЭКСПЕРИМЕНТАЛЬНЫЙ ДИЗАЙН
*/

#include <Wire.h>          // эта библиотека чтобы по проводам общаться с дисплеем
#include <Adafruit_GFX.h>  // эта чтобы рисовать на экране всякие кружочки и текст
#include <Adafruit_SSD1306.h> // а эта конкретно для нашего экранчика SSD1306
#include <EEPROM.h>        // эта чтобы память помнила рекорды даже когда питание вырубили

// РАЗМЕРЫ ЭКРАНА (Я ИХ СПИСАЛ ИЗ ИНТЕРНЕТА, НАДЕЮСЬ НЕ ОБМАНУЛИ)
#define WIDTH 128  // столько точек в ширину (можно рисовать 128 пикселей слева направо)
#define HEIGHT 64  // столько точек в высоту (всего 64 пикселя сверху вниз, маловато но что есть)
#define OLED_RST -1 // пин сброса но он не нужен (зачем я его написал? хз, наверное для красоты)

// ПИНЫ КНОПОК (Я ИХ ВОТКНУЛ КАК ПРОПАЛО В ПЛАТУ ESP32)
#define BTN1   12  // первая кнопка слева (самая важная потому что первая)
#define BTN2   14  // вторая кнопка (тоже важная но уже не так как первая)
#define BTN3   27  // третья кнопка (уже не очень важная, но все равно нужна)
#define BTN4   26  // четвертая кнопка (вообще пофиг какая, но без нее игра не полная)

// СОЗДАЕМ ЭКРАН (ЭТО ТИПА КАК ТЕЛЕВИЗОР ТОЛЬКО МАЛЕНЬКИЙ И ЧЕРНО-БЕЛЫЙ)
Adafruit_SSD1306 screen(WIDTH, HEIGHT, &Wire, OLED_RST);

// ТУТ У МЕНЯ ПЕРЕМЕННЫЕ ДЛЯ ИГРЫ (ИХ МНОГО И ОНИ СТРАШНЫЕ НО БЕЗ НИХ НИКУДА)

unsigned long startGameTime;        // когда игра началась (в миллисекундах, типа точное время)
unsigned long pressButtonTime;      // когда кнопку нажали (тоже в миллисекундах, чтобы посчитать реакцию)
unsigned long readyScreenTime;      // когда показали экран "готовься" (чтобы знать когда началась пауза)
unsigned long randomDelayTime;      // случайная задержка перед игрой (от 2 до 5 секунд чтобы скучно не было)
int needButton = 0;                 // какая кнопка нужна (0-первая, 1-вторая, 2-третья, 3-четвертая)
bool gameGo = false;                // игра идет или нет (true-идет, false-не идет, все просто)
bool buttonAlreadyPress = false;    // кнопку уже нажали или нет (чтобы два раза не считать одно нажатие)
bool showReady = false;             // показываем экран "готовься" или нет (состояние игры)
bool showWhatButton = false;        // показываем какую кнопку жать или нет (другое состояние игры)
int points = 0;                     // очки (чем больше тем круче, все как в настоящих играх)
float bestReaction = 0.0;           // лучший время реакции (рекорд который все хотят побить)
float nowReaction = 0.0;            // текущее время реакции (сколько секунд ты жал кнопку в этом раунде)
float timeForPress = 1.0;           // сколько времени дается на нажатие (сначала 1 секунда, потом меньше)
int hardLevel = 1;                  // уровень сложности (чем больше тем сложнее, как в жизни)

// как кнопки называются (просто цифры 1,2,3,4 - я не стал выебываться с буквами или символами)
const char* buttonText[4] = {"1", "2", "3", "4"};

// функция setup запускается один раз при включении (типа как включил игру и она настроилась)
void setup() {
  Serial.begin(115200);  // включаем сериал порт (чтобы в комп писать что происходит, для отладки)
  
  // настраиваем кнопки (INPUT_PULLUP это типа внутри есть резистор который тянет к питанию)
  pinMode(BTN1, INPUT_PULLUP);  // первая кнопка (когда не нажата - HIGH, когда нажата - LOW)
  pinMode(BTN2, INPUT_PULLUP);  // вторая кнопка (так же как и первая)
  pinMode(BTN3, INPUT_PULLUP);  // третья кнопка (и эта тоже)
  pinMode(BTN4, INPUT_PULLUP);  // четвертая кнопка (все кнопки одинаковые, скучно но надежно)
  
  // включаем дисплей (если не включится то все сломалось и игра не работает)
  if(!screen.begin(SSD1306_SWITCHCAPVCC, 0x3C)) {
    Serial.println("Display broken :("); // пишем в сериал порт что все плохо
    for(;;); // вечный цикл (типа зависаем навсегда потому что без экрана игра не нужна)
  }
  
  screen.clearDisplay(); // очищаем дисплей (убираем все что было там раньше, мусор например)
  screen.setTextColor(WHITE); // ставим белый цвет текста (на черном фоне красиво и видно хорошо)
  
  // грузим рекорд из памяти (если он там есть и не испортился)
  loadBestTime();
  
  // показываем прикольную заставку (самую крутую часть которую я сделал, горжусь ей)
  showCoolStart();
  
  // показываем начало игры (где написано про реакцию и какие кнопки жать)
  showGameStart();
}

// это самая крутая заставка которую я смог придумать (я горжусь ей как слон)
void showCoolStart() {
  screen.clearDisplay(); // очищаем экран (начинаем с чистого листа)
  
  // буквы появляются по одной (типа как в матрице только проще и без зеленых символов)
  for(int i = 0; i <= 8; i++) { // 8 букв в слове LAKLADON (это мой ник)
    screen.clearDisplay(); // каждый раз чистим экран (чтобы было красиво и анимация плавная)
    screen.setTextSize(1); // размер текста 1 (маленький но читаемый)
    screen.setCursor(30, 20); // ставим курсор куда писать (30 от левого края, 20 от верхнего)
    String text = "LAKLADON"; // мой крутой ник (не смейтесь, я долго придумывал)
    for(int j = 0; j < i; j++) { // печатаем по одной букве (от 0 до i-1)
      screen.print(text[j]); // печатаем очередную букву (j-ю букву из текста)
    }
    
    // точки мигают (типа загрузка как в настоящих играх только без прогресс-бара)
    if(i == 8) { // когда все буквы напечатаны (i=8 значит все 8 букв показали)
      for(int dot = 0; dot < 4; dot++) { // 4 точки которые появляются по одной (dot от 0 до 3)
        screen.clearDisplay(); // опять чистим экран (я люблю чистоту как немец)
        screen.setCursor(30, 20); // ставим курсор на начало текста
        screen.print("LAKLADON"); // печатаем весь текст (все 8 букв разом)
        screen.setCursor(35, 35); // курсор ниже (35 от верха, под основным текстом)
        screen.setTextSize(1); // размер текста 1 (маленький для подписи)
        screen.print("presents"); // пишем presents (типа я представляю игру, как в кино)
        
        // рисуем точки которые появляются по одной (типа loading... но без букв)
        screen.setCursor(55 + dot * 5, 45); // двигаем курсор для точек (55 от левого + смещение для каждой точки)
        for(int d = 0; d <= dot; d++) { // печатаем точки которые уже должны быть видны
          screen.print("."); // печатаем точку (просто точку, ничего сложного)
        }
        screen.display(); // показываем на дисплее что получилось
        delay(300); // ждем немного чтобы было видно анимацию (300 миллисекунд)
      }
    } else { // если еще не все буквы напечатаны (i < 8)
      screen.display(); // показываем что получилось (текст с несколькими буквами)
      delay(200); // ждем 200 миллисекунд между появлением букв (не слишком быстро и не слишком медленно)
    }
  }
  
  delay(1000); // ждем секунду чтобы полюбоваться на свою работу (тыжпрограммист)
  
  // все исчезает (типа плавно уходит как в кино только без спецэффектов)
  for(int i = 0; i < 16; i++) { // 16 шагов исчезновения (16*4=64 - вся высота экрана)
    screen.clearDisplay(); // чистим экран (опять, я зануда)
    screen.setTextSize(1); // размер текста 1
    screen.setCursor(30, 20); // ставим курсор
    screen.print("LAKLADON"); // печатаем текст
    screen.setTextSize(1); // размер текста 1
    screen.setCursor(35, 35); // курсор ниже
    screen.print("presents"); // пишем presents
    
    // рисуем черные линии которые постепенно заполняют экран сверху вниз
    for(int y = 0; y < HEIGHT; y += 4) { // идем по высоте экрана с шагом 4 пикселя
      if(y >= i * 4) { // если текущая строка должна быть черной (y >= i*4)
        screen.drawFastHLine(0, y, WIDTH, BLACK); // черная линия во всю ширину экрана
      }
    }
    screen.display(); // показываем что получилось
    delay(50); // ждем 50 миллисекунд (быстрая анимация чтобы не засыпали)
  }
  
  screen.clearDisplay(); // окончательно чистим экран (на всякий случай)
  screen.display(); // и показываем чистый экран (готовы к игре по-настоящему)
}

// грузим лучший время из EEPROM (типа из памяти ардуины которая не стирается при выключении)
void loadBestTime() {
  // читаем 4 байта из памяти (байты это типа цифры но маленькие, float состоит из 4 байтов)
  byte b0 = EEPROM.read(0); // первый байт из ячейки 0 (самый младший байт)
  byte b1 = EEPROM.read(1); // второй байт из ячейки 1 (чуть старше)
  byte b2 = EEPROM.read(2); // третий байт из ячейки 2 (еще старше)
  byte b3 = EEPROM.read(3); // четвертый байт из ячейки 3 (самый старший байт)
  
  float value; // сюда положим время которое соберем из байтов
  byte *b = (byte*)&value; // это магия какая-то (я списал из интернета) - преобразуем указатель на float в указатель на byte
  b[0] = b0; // первый байт времени (записываем прочитанный байт в память)
  b[1] = b1; // второй байт времени (и этот тоже)
  b[2] = b2; // третий байт времени (и этот)
  b[3] = b3; // четвертый байт времени (и последний)
  
  // проверяем что время нормальное (не какая-то ерунда вроде NaN или отрицательное)
  if (!isnan(value) && value > 0.00 && value < 10.00) { // если число нормальное и между 0 и 10 секундами
    bestReaction = value; // ставим рекорд (ура, нашли сохраненный рекорд)
  } else {
    bestReaction = 0.00; // или 0 если ерунда (значит рекорда еще нет или память испортилась)
  }
}

// сохраняем лучший время в память (чтобы не потерялось когда выключим питание)
void saveBestTime() {
  if (bestReaction == 0.00) return; // если 0 то не сохраняем (зачем нам нулевой рекорд?)
  
  byte *b = (byte*)&bestReaction; // опять магия с байтами (преобразуем float в байты)
  
  // пишем 4 байта в память (каждый байт в свою ячейку)
  EEPROM.write(0, b[0]); // первый байт в ячейку 0 (самый младший)
  EEPROM.write(1, b[1]); // второй байт в ячейку 1 (посередине)
  EEPROM.write(2, b[2]); // третий байт в ячейку 2 (почти старший)
  EEPROM.write(3, b[3]); // четвертый байт в ячейку 3 (самый старший)
  
  EEPROM.commit(); // сохраняем на самом деле (в ESP32 так надо, иначе не запишется в flash)
}

// главный цикл который крутится всегда (пока ардуино включено, он постоянно выполняется)
void loop() {
  // состояние 1: игра не идет и не показываем экран готовности (ждем начала игры)
  if (!gameGo && !showReady) {
    // если нажали любую кнопку (любую из четырех, неважно какую)
    if (digitalRead(BTN1) == LOW || digitalRead(BTN2) == LOW || 
        digitalRead(BTN3) == LOW || digitalRead(BTN4) == LOW) {
      delay(200); // ждем немного (чтобы не дребезжало и не считало несколько нажатий)
      showReady = true; // показываем экран готовности (переходим к следующему состоянию)
      readyScreenTime = millis(); // запоминаем когда начали показывать экран готовности
      showReadyScreen(); // показываем экран "готовься" (вызываем функцию)
    }
  } 
  // состояние 2: показываем экран готовности но еще не показали какую кнопку жать (случайная пауза)
  else if (showReady && !showWhatButton) {
    // если прошло достаточно времени случайного (от 2 до 5 секунд которые сгенерировали раньше)
    if (millis() - readyScreenTime > randomDelayTime) {
      showWhatButton = true; // теперь показываем какую кнопку жать
      startTheGame(); // начинаем игру (показываем цифру которую нужно нажать)
    }
    
    // если нажали кнопку слишком рано (не дождались сигнала, нетерпеливый)
    if (digitalRead(BTN1) == LOW || digitalRead(BTN2) == LOW || 
        digitalRead(BTN3) == LOW || digitalRead(BTN4) == LOW) {
      gameOver(true); // игра окончена (ты жмакал рано, балбес)
    }
  } 
  // состояние 3: игра идет и показываем какую кнопку жать (основной игровой процесс)
  else if (gameGo && showWhatButton) {
    checkButtons(); // проверяем кнопки (нажал или нет, правильную или нет)
    
    // если время вышло и кнопку не нажали (ты слишком медленный как улитка)
    if (millis() - startGameTime > (timeForPress * 1000) && !buttonAlreadyPress) {
      gameOver(false); // игра окончена (ты медленный как черепаха)
    }
  }
}

// показываем экран "готовься" (где написано жди сигнал и не жми рано)
void showReadyScreen() {
  randomDelayTime = random(2000, 5001); // случайное время от 2 до 5 секунд (2000-5000 миллисекунд)
  
  screen.clearDisplay(); // чистим экран (убираем все старое)
  screen.setTextSize(1); // размер текста 1 (маленький но хватит)
  screen.setCursor(50, 20); // ставим курсор (50 от левого края, 20 от верхнего)
  screen.print("READY?"); // пишем READY? по английски (чтобы не было кракозябр)
  
  screen.setTextSize(1); // размер текста 1 (такой же как выше)
  screen.setCursor(35, 35); // курсор ниже (35 от верха)
  screen.print("Wait..."); // пишем Wait... (коротко чтобы влезло)
  
  screen.setCursor(30, 45); // курсор еще ниже (45 от верха)
  screen.print("Dont press!"); // пишем Dont press! (не жми рано)
  screen.display(); // показываем на дисплее
}

// начинаем игру (показываем какую кнопку жать и запускаем таймер)
void startTheGame() {
  gameGo = true; // игра пошла (теперь отсчитываем время)
  buttonAlreadyPress = false; // кнопку еще не нажали (сбрасываем флаг)
  startGameTime = millis(); // запоминаем когда началась игра (запускаем таймер)
  
  needButton = random(0, 4); // случайная кнопка от 0 до 3 (выбираем какую кнопку нужно нажать)
  
  screen.clearDisplay(); // чистим экран (готовимся к рисованию игрового экрана)
  
  // что делать (надпись сверху)
  screen.setTextSize(1); // размер текста 1 (мелкий)
  screen.setCursor(50, 5); // ставим курсор (50 от левого, 5 от верхнего)
  screen.print("PRESS:"); // пишем PRESS: (жми)
  
  // большая цифра посередине (какую кнопку жать)
  screen.setTextSize(2); // размер текста 2 (средний, хорошо видно)
  screen.setCursor(55, 20); // ставим курсор по центру (55 от левого, 20 от верхнего)
  screen.print(buttonText[needButton]); // печатаем цифру кнопки которую нужно нажать
  
  // инфа об игре внизу (время, уровень, очки, рекорд) - все компактно
  screen.setTextSize(1); // размер текста 1 (мелкий для информации)
  
  screen.setCursor(5, 45);   // ЛЕВЫЙ ВЕРХНИЙ УГОЛ (5 от левого, 45 от верхнего)
  screen.print("T:"); // пишем T: (время)
  screen.print(timeForPress, 1); // печатаем время (с одной цифрой после запятой)
  screen.print("s"); // пишем s (секунды)
  
  screen.setCursor(65, 45);  // ПРАВЫЙ ВЕРХНИЙ УГОЛ (65 от левого, 45 от верхнего)
  screen.print("L:"); // пишем L: (уровень)
  screen.print(hardLevel); // печатаем уровень (просто число)
  
  screen.setCursor(5, 55);   // ЛЕВЫЙ НИЖНИЙ УГОЛ (5 от левого, 55 от верхнего)
  screen.print("S:"); // пишем S: (очки)
  screen.print(points); // печатаем очки (сколько уже набрал)
  
  screen.setCursor(65, 55);  // ПРАВЫЙ НИЖНИЙ УГОЛ (65 от левого, 55 от верхнего)
  screen.print("B:"); // пишем B: (рекорд)
  screen.print(bestReaction, 1); // печатаем рекорд (с одной цифрой после запятой)
  screen.print("s"); // пишем s (секунды)
  
  screen.display(); // показываем все на дисплее
}

// проверяем кнопки (нажал или нет, и если нажал то какую)
void checkButtons() {
  // если кнопку еще не нажали в этом раунде и показываем какую жать
  if (!buttonAlreadyPress && showWhatButton) {
    // если нажали правильную кнопку (ту которую просили)
    if ((needButton == 0 && digitalRead(BTN1) == LOW) || // если нужна кнопка 1 и нажали кнопку 1
        (needButton == 1 && digitalRead(BTN2) == LOW) || // если нужна кнопка 2 и нажали кнопку 2
        (needButton == 2 && digitalRead(BTN3) == LOW) || // если нужна кнопка 3 и нажали кнопку 3
        (needButton == 3 && digitalRead(BTN4) == LOW)) { // если нужна кнопка 4 и нажали кнопку 4
      buttonAlreadyPress = true; // кнопку нажали (больше не проверяем в этом раунде)
      pressButtonTime = millis(); // запоминаем когда нажали (чтобы посчитать время реакции)
      processPress(); // обрабатываем нажатие (считаем время, начисляем очки и т.д.)
    }
    // если нажали неправильную кнопку (не ту которую просили)
    else if ((needButton != 0 && digitalRead(BTN1) == LOW) || // если нужна не кнопка 1 а нажали кнопку 1
             (needButton != 1 && digitalRead(BTN2) == LOW) || // если нужна не кнопка 2 а нажали кнопку 2
             (needButton != 2 && digitalRead(BTN3) == LOW) || // если нужна не кнопка 3 а нажали кнопку 3
             (needButton != 3 && digitalRead(BTN4) == LOW)) { // если нужна не кнопка 4 а нажали кнопку 4
      gameOver(false); // игра окончена (не ту кнопку жмакнул, растяпа)
    }
  }
}

// обрабатываем нажатие кнопки (посчитали время и все такое)
void processPress() {
  // считаем время реакции в секундах (разница между нажатием и началом игры деленная на 1000)
  nowReaction = (pressButtonTime - startGameTime) / 1000.0;
  
  // если успел вовремя (время реакции меньше или равно разрешенному времени)
  if (nowReaction <= timeForPress) {
    points++; // добавляем очко (ура, ты молодец!)
    
    // если это новый рекорд (текущее время лучше предыдущего рекорда или рекорда еще нет)
    if (nowReaction < bestReaction || bestReaction == 0.00) {
      bestReaction = nowReaction; // ставим новый рекорд (ты чемпион!)
      saveBestTime(); // сохраняем в память (чтобы не забыть)
    }
    
    makeHarder(); // делаем игру сложнее (добавляем уровень и уменьшаем время)
    
    showWinScreen(); // показываем экран победы (ты победил!)
    delay(1500); // ждем 1.5 секунды чтобы игрок увидел что он молодец
    
    // снова показываем экран готовности (готовимся к следующему раунду)
    showReady = true;
    showWhatButton = false;
    readyScreenTime = millis();
    showReadyScreen();
  } else {
    gameOver(false); // если не успел вовремя (время вышло)
  }
}

// делаем игру сложнее (чем больше очков тем меньше времени дается на реакцию)
void makeHarder() {
  if (points <= 10) { // от 0 до 10 очков
    timeForPress = 1.00; // 1 секунда (много времени)
    hardLevel = 1; // уровень 1 (легкий)
  } else if (points <= 20) { // от 11 до 20 очков
    timeForPress = 0.80; // 0.8 секунды (чуть меньше)
    hardLevel = 2; // уровень 2 (нормальный)
  } else if (points <= 30) { // от 21 до 30 очков
    timeForPress = 0.60; // 0.6 секунды (еще меньше)
    hardLevel = 3; // уровень 3 (средний)
  } else if (points <= 40) { // от 31 до 40 очков
    timeForPress = 0.45; // 0.45 секунды (уже сложно)
    hardLevel = 4; // уровень 4 (сложный)
  } else if (points <= 50) { // от 41 до 50 очков
    timeForPress = 0.35; // 0.35 секунды (очень сложно)
    hardLevel = 5; // уровень 5 (очень сложный)
  } else if (points <= 60) { // от 51 до 60 очков
    timeForPress = 0.25; // 0.25 секунды (почти нереально)
    hardLevel = 6; // уровень 6 (эксперт)
  } else if (points <= 70) { // от 61 до 70 очков
    timeForPress = 0.18; // 0.18 секунды (супер сложно)
    hardLevel = 7; // уровень 7 (мастер)
  } else if (points <= 80) { // от 71 до 80 очков
    timeForPress = 0.12; // 0.12 секунды (невероятно сложно)
    hardLevel = 8; // уровень 8 (грандмастер)
  } else if (points <= 90) { // от 81 до 90 очков
    timeForPress = 0.08; // 0.08 секунды (невозможно)
    hardLevel = 9; // уровень 9 (легенда)
  } else if (points <= 100) { // от 91 до 100 очков
    timeForPress = 0.05; // 0.05 секунды (божественно)
    hardLevel = 10; // уровень 10 (бог)
  } else { // больше 100 очков
    timeForPress = 0.03; // 0.03 секунды (это читерство)
    hardLevel = 11; // уровень 11 (нечеловек)
  }
}

// игра окончена (проиграл по какой-то причине)
void gameOver(bool tooEarly) {
  gameGo = false; // игра не идет (останавливаем все)
  showReady = false; // не показываем готовность
  showWhatButton = false; // не показываем кнопку
  
  screen.clearDisplay(); // чистим экран (рисуем экран проигрыша)
  screen.setTextSize(1); // размер текста 1 (маленький чтобы все влезло)
  screen.setCursor(40, 10); // ставим курсор (40 от левого, 10 от верхнего)
  screen.print("GAME OVER"); // пишем GAME OVER (все пропало)
  
  screen.setTextSize(1); // размер текста 1 (такой же)
  screen.setCursor(10, 25); // курсор ниже (10 от левого, 25 от верхнего)
  screen.print("S:"); // пишем S: (очки)
  screen.print(points); // печатаем очки (сколько успел набрать)
  
  screen.setCursor(70, 25); // справа (70 от левого, 25 от верхнего)
  screen.print("L:"); // пишем L: (уровень)
  screen.print(hardLevel); // печатаем уровень (до какого дошел)
  
  screen.setCursor(10, 35); // еще ниже (10 от левого, 35 от верхнего)
  screen.print("B:"); // пишем B: (рекорд)
  screen.print(bestReaction, 2); // печатаем рекорд (с двумя цифрами после запятой)
  screen.print("s"); // пишем s (секунды)
  
  // пишем почему проиграл (в зависимости от причины)
  if (tooEarly) { // если нажал слишком рано
    screen.setCursor(30, 45); // ставим курсор (30 от левого, 45 от верхнего)
    screen.print("TOO EARLY!"); // пишем TOO EARLY! (нетерпеливый)
    screen.setCursor(25, 55); // ниже (25 от левого, 55 от верхнего)
    screen.print("Wait signal!"); // пишем Wait signal! (жди сигнала)
  } else if (nowReaction > timeForPress) { // если не успел вовремя
    screen.setCursor(35, 45); // ставим курсор (35 от левого, 45 от верхнего)
    screen.print("TOO SLOW!"); // пишем TOO SLOW! (черепаха)
    screen.setCursor(20, 55); // ниже (20 от левого, 55 от верхнего)
    screen.print("T:"); // пишем T: (время)
    screen.print(nowReaction, 2); // печатаем время (с двумя цифрами после запятой)
    screen.print("s"); // пишем s (секунды)
  } else { // если нажал не ту кнопку
    screen.setCursor(30, 45); // ставим курсор (30 от левого, 45 от верхнего)
    screen.print("WRONG BTN!"); // пишем WRONG BTN! (внимательнее надо)
  }
  
  screen.display(); // показываем на дисплее экран проигрыша
  
  // сбрасываем очки и уровень (начинаем с начала)
  points = 0;
  hardLevel = 1;
  timeForPress = 1.00;
  
  // ждем пока кнопку нажмут (чтобы продолжить и начать заново)
  while(digitalRead(BTN1) == HIGH && digitalRead(BTN2) == HIGH && 
        digitalRead(BTN3) == HIGH && digitalRead(BTN4) == HIGH) {
    delay(100); // ждем 100 миллисекунд (не грузим процессор)
  }
  
  showGameStart(); // показываем стартовый экран (начинаем все сначала)
}

// показываем экран победы (когда успел вовремя нажать правильную кнопку)
void showWinScreen() {
  screen.clearDisplay(); // чистим экран (рисуем экран победы)
  screen.setTextSize(1); // размер текста 1 (маленький)
  screen.setCursor(45, 15); // ставим курсор (45 от левого, 15 от верхнего)
  screen.print("SUCCESS!"); // пишем SUCCESS! (ты молодец!)
  
  screen.setTextSize(1); // размер текста 1 (такой же)
  screen.setCursor(20, 30); // ниже (20 от левого, 30 от верхнего)
  screen.print("T:"); // пишем T: (время)
  screen.print(nowReaction, 2); // печатаем время (с двумя цифрами после запятой)
  screen.print("s"); // пишем s (секунды)
  
  screen.setCursor(20, 40); // еще ниже (20 от левого, 40 от верхнего)
  screen.print("S:"); // пишем S: (очки)
  screen.print(points); // печатаем очки (сколько уже набрал)
  
  screen.setCursor(20, 50); // еще ниже (20 от левого, 50 от верхнего)
  screen.print("L:"); // пишем L: (уровень)
  screen.print(hardLevel); // печатаем уровень (текущий уровень сложности)
  
  // если это новый рекорд (побили предыдущее лучшее время)
  if (nowReaction == bestReaction) {
    screen.setCursor(25, 25); // ставим курсор (25 от левого, 25 от верхнего)
    screen.print("NEW RECORD!"); // пишем NEW RECORD! (ты чемпион!)
  }
  
  screen.display(); // показываем на дисплее экран победы
}

// показываем стартовый экран игры (при запуске и после проигрыша)
void showGameStart() {
  screen.clearDisplay(); // чистим экран (рисуем стартовый экран)
  screen.setTextSize(1); // размер текста 1 (маленький чтобы все влезло)
  screen.setCursor(40, 15); // ставим курсор (40 от левого, 15 от верхнего)
  screen.print("REACTION"); // пишем REACTION (название игры)
  screen.setCursor(50, 25); // ниже (50 от левого, 25 от верхнего)
  screen.print("TEST"); // пишем TEST (типа тест на реакцию)
  
  screen.setTextSize(1); // размер текста 1 (такой же)
  screen.setCursor(20, 40); // ниже (20 от левого, 40 от верхнего)
  screen.print("Press correct"); // пишем Press correct (нажми правильную)
  screen.setCursor(30, 50); // еще ниже (30 от левого, 50 от верхнего)
  screen.print("button!"); // пишем button! (кнопку)
  
  screen.setCursor(40, 35); // посередине (40 от левого, 35 от верхнего)
  screen.print("Btns:1-4"); // пишем Btns:1-4 (кнопки от 1 до 4)
  
  // если есть рекорд показываем его
  if (bestReaction > 0.00) {
    screen.setCursor(25, 60); // в самом низу (25 от левого, 60 от верхнего)
    screen.print("Best:"); // пишем Best: (рекорд)
    screen.print(bestReaction, 2); // печатаем рекорд (с двумя цифрами после запятой)
    screen.print("s"); // пишем s (секунды)
  }
  
  screen.display(); // показываем на дисплее
}